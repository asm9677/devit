<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ssafy.devit.repository.MyBoardRepository">
		
		
	<!-- 내가 쓴 게시글 목록 조회 -->
	      <select id="myBoardList" resultType="BoardResponse">
         select a.board_id as boardId, 
         		a.user_id as userId, 
         		b.nickname as userName, 
         		b.profile as profile,
         		a.title as boardTitle, 
         		a.content as boardContent, 
         		a.type as boardType, 
         		a.created as boardCreated, 
         		a.count as boardCount, 
         		(select count(1) from board_reply where delete_yn = 'N' and board_id = a.board_id) as replyCount,
         		a.modified as boardModified,
         		case when c.cnt is null then 0
                     when c.cnt = 0 then 0
                     else ceil(c.cnt/#{itemsperpage})
				end as pageCnt
           from board a
		        inner join 
		        user b 
		        on 
		        a.user_id = b.user_id
                left outer join
                (
         		 select count(1) as cnt
         		   from board a
         		  where a.user_id = #{userId}
            		and a.delete_yn = 'N'
            		<!-- and a.lecture_id is null -->
				) c
				on
				1=1
          where a.user_id = #{userId}
            and a.delete_yn = 'N'
            <!-- and a.lecture_id is null -->
       order by a.board_id desc
		  limit #{startPage} , #{itemsperpage};
		  
      </select>
		
		
	<!-- 내가 쓴 댓글 목록 조회 -->
	      <select id="myReplyList" resultType="BoardResponse">
         select a.board_id as boardId, 
         		a.user_id as userId, 
         		b.nickname as userName, 
         		b.profile as profile,
         		c.reply_content as boardTitle, 
         		a.title as boardContent, 
         		a.type as boardType, 
         		a.created as boardCreated, 
         		a.count as boardCount, 
         		(select count(1) from board_reply where delete_yn = 'N' and board_id = a.board_id) as replyCount,
         		a.modified as boardModified,
         		case when c.cnt is null then 0
                     when c.cnt = 0 then 0
                     else ceil(c.cnt/#{itemsperpage})
				end as pageCnt,
				c.board_reply_id as boardReplyId
           from board a
		        inner join 
		        user b 
		        on 
		        a.user_id = b.user_id
   		        inner join
   		        board_reply c
   		        on
   		        a.board_id = c.board_id
                left outer join
                (
         		 select count(1) as cnt
         		   from board a
         		        inner join
         		        board_reply b
         		        on
         		        a.board_id = b.board_id
         		  where b.user_id = #{userId}
            		and a.delete_yn = 'N'
            		and b.delete_yn = 'N'
            		<!-- and a.lecture_id is null -->
				) c
				on
				1=1
          where c.user_id = #{userId}
            and a.delete_yn = 'N'
            and c.delete_yn = 'N'
            <!-- and a.lecture_id is null -->
       order by c.board_reply_id desc
		  limit #{startPage} , #{itemsperpage};
		  
      </select>
</mapper>